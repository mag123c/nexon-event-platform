# ğŸ”§ ì„¤ê³„ êµ¬ì¡° (Initial Architecture Draft)

ì„œë¹„ìŠ¤ì˜ êµ¬ì„± ìš”ì†Œë¥¼ êµ¬ìƒí•  ë•Œ ìš”êµ¬ì‚¬í•­ì— ë”°ë¼ ë‹¤ìŒê³¼ ê°™ì€ êµ¬ì¡°ë¡œ ì‹œê°í™”í•˜ë©´ì„œ ì¶œë°œí–ˆìŠµë‹ˆë‹¤:

![Initial Architecture Diagram](./assets/architecture-initial.png)

> ê° ì„œë²„ì˜ ì±…ì„ì„ ë¶„ë¦¬í•˜ê³  Gatewayë¥¼ ì§„ì…ì ìœ¼ë¡œ ì„¤ì •í•œ ê¸°ë³¸ì ì¸ MSA í˜•íƒœì…ë‹ˆë‹¤.



## ğŸ“ í”„ë¡œì íŠ¸ ë””ë ‰í† ë¦¬ êµ¬ì¡°

ìƒì„¸ ë””ë ‰í† ë¦¬ êµ¬ì¡°ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤.

---

### 1. Auth Server (`apps/auth`)

Auth ServerëŠ” ì‚¬ìš©ì ê³„ì • ê´€ë¦¬ ë° ì¸ì¦ í† í° ë°œê¸‰ì„ ì „ë‹´í•©ë‹ˆë‹¤.

*   ì£¼ìš” ê¸°ëŠ¥: ì‚¬ìš©ì ë“±ë¡, ë¡œê·¸ì¸, ì—­í•  ê´€ë¦¬, JWT ë°œê¸‰ ë° ê²€ì¦ (ë‚´ë¶€ìš©)

```text
apps/
â””â”€â”€ auth/
    â”œâ”€â”€ src/
    â”‚   â”œâ”€â”€ application/                                   // ì• í”Œë¦¬ì¼€ì´ì…˜ ì„œë¹„ìŠ¤ ë° ìœ ìŠ¤ì¼€ì´ìŠ¤
    â”‚   â”‚   â””â”€â”€ use-cases/                                 // ì‹œìŠ¤í…œì˜ ì£¼ìš” ê¸°ëŠ¥ ë‹¨ìœ„ (ì˜ˆ: íšŒì›ê°€ì…, ë¡œê·¸ì¸)
    â”‚   â”‚       â”œâ”€â”€ login-user/                            // ë¡œê·¸ì¸
    â”‚   â”‚       â”‚   â”œâ”€â”€ login-user.usecase.ts              // ë¡œê·¸ì¸ ìœ ì¦ˆì¼€ì´ìŠ¤
    â”‚   â”‚       â”‚   â”œâ”€â”€ login-user.usecase.spec.ts         // ìœ ì¦ˆì¼€ì´ìŠ¤ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
    â”‚   â”‚       â”‚   â””â”€â”€ login-user.input.ts                // ìœ ìŠ¤ì¼€ì´ìŠ¤ ë‚´ë¶€ ì…ë ¥ ì¸í„°í˜ì´ìŠ¤ ì •ì˜
    â”‚   â”‚       â”‚   â””â”€â”€ login-user.output.ts               // ìœ ìŠ¤ì¼€ì´ìŠ¤ ë‚´ë¶€ì—ì„œ ë‚˜ê°€ëŠ” ì¸í„°í˜ì´ìŠ¤ ì •ì˜
    â”‚   â”‚       â””â”€â”€ register-user/                         // íšŒì› ê°€ì…
    â”‚   â”‚           â”œâ”€â”€ register-user.usecase.ts 
    â”‚   â”‚           â”œâ”€â”€ register-user.usecase.spec.ts
    â”‚   â”‚           â””â”€â”€ register-user.input.ts                     
    â”‚   â”‚   
    â”‚   â”‚   
    â”‚   â”œâ”€â”€ domain/                                        // í•µì‹¬ ë¹„ì¦ˆë‹ˆìŠ¤ ë¡œì§ ë° ë„ë©”ì¸ ëª¨ë¸
    â”‚   â”‚   â”œâ”€â”€ entities/                                  // ë„ë©”ì¸ ì—”í‹°í‹° (ë‚´ë¶€ ìƒëµ)
    â”‚   â”‚   â”œâ”€â”€ errors/                                    // í•´ë‹¹ ë„ë©”ì¸ì˜ ì—ëŸ¬ ì •ì˜ (ë‚´ë¶€ ìƒëµ)
    â”‚   â”‚   â”œâ”€â”€ ports/                                     // ë„ë©”ì¸ ë‚´ë¶€ ì¸í„°í˜ì´ìŠ¤ ëª¨ìŒ (DIP)
    â”‚   â”‚   â”‚   â””â”€â”€ user.repository.ts                     // ì˜ì† ê³„ì¸µ ì ‘ê·¼ ì¸í„°í˜ì´ìŠ¤
    â”‚   â”‚   â”‚   â””â”€â”€ hasing.port.ts                         // ì•”í˜¸í™”ë¥¼ ìœ„í•œ ì¸í„°í˜ì´ìŠ¤
    â”‚   â”‚   â”‚   â””â”€â”€ token-generator.port.ts                // í† í° ìƒì„± ì¸í„°í˜ì´ìŠ¤
    â”‚   â”‚   â””â”€â”€ value-objects/                             // ë„ë©”ì¸ ë‚´ë¶€ ìˆœìˆ˜ ê°’ ê°ì²´ (ë‚´ë¶€ ìƒëµ)
    â”‚   â”‚ 
    â”‚   â”‚   
    â”‚   â”œâ”€â”€ infrastructure/                                // ì™¸ë¶€ ì‹œìŠ¤í…œ ì—°ë™ ë° ì‹¤ì œ êµ¬í˜„ì²´    
    â”‚   â”‚   â”œâ”€â”€ hashing/                                   // ë¹„ë°€ë²ˆí˜¸ í•´ì‹±
    â”‚   â”‚   â”‚   â””â”€â”€ argon2.service.ts
    â”‚   â”‚   â”œâ”€â”€ jwt/                                       // JWT (nestjs/jwt)
    â”‚   â”‚   â”‚   â””â”€â”€ jwt.service.ts
    â”‚   â”‚   â””â”€â”€ persistence/                               // DB (ì˜ì† ê³„ì¸µ)
    â”‚   â”‚       â””â”€â”€ user-mongo.repository.ts               // MongoDB ê¸°ë°˜ User ë¦¬í¬ì§€í† ë¦¬ êµ¬í˜„ì²´ (ë‹¤ë¥¸ ì˜ì† ê³„ì¸µì´ ìˆë‹¤ë©´ ë””ë ‰í† ë¦¬ ë¶„ë¥˜)
    â”‚   â”‚ 
    â”‚   â”‚ 
    â”‚   â”œâ”€â”€ presentation/                                  // ì™¸ë¶€ ì—°ë™ ì¸í„°í˜ì´ìŠ¤ (API ì»¨íŠ¸ë¡¤ëŸ¬, DTO ë“±)
    â”‚   â”‚   â”œâ”€â”€ controllers/                               // HTTP ìš”ì²­ ì²˜ë¦¬ ì»¨íŠ¸ë¡¤ëŸ¬ (ë‚´ë¶€ ìƒëµ)
    â”‚   â”‚   â””â”€â”€ dtos/                                      // DTO (ë‚´ë¶€/ì„¤ëª… ìƒëµ)
    â”‚   â”‚       â”œâ”€â”€ request/
    â”‚   â”‚       â””â”€â”€ response/
    â”‚   â”‚       
    â”‚   â”‚       
    â”‚   â”‚â”€â”€ user/                                          // ì‚¬ìš©ì ê´€ë¦¬
    â”‚   â”‚   â”œâ”€â”€ application/
    â”‚   â”‚   â”‚   â””â”€â”€ use-cases
    â”‚   â”‚   â”‚       â””â”€â”€ get-user                           // ìœ ì € ì •ë³´
    â”‚   â”‚   â”œâ”€â”€ domain/
    â”‚   â”‚   â”‚   â”œâ”€â”€ entities/                            
    â”‚   â”‚   â”‚   â”œâ”€â”€ errors/                                  
    â”‚   â”‚   â”‚   â”œâ”€â”€ ports/                                   
    â”‚   â”‚   â”‚   â””â”€â”€ ...
    â”‚   â”‚   â”œâ”€â”€ infrastructure/
    â”‚   â”‚   â”‚   â””â”€â”€ persistence/                       
    â”‚   â”‚   â”œâ”€â”€ presentation/
    â”‚   â”‚   â”‚   â”œâ”€â”€ controllers/                       
    â”‚   â”‚   â”‚   â””â”€â”€ dtos/                              
    â”‚   â”‚   â””â”€â”€ user.module.ts                         
    â”‚   â”‚ 
    â”‚   â”‚     
    â”œâ”€â”€ test/
    â”‚   â””â”€â”€ fixture/                                       // ìœ ì € ìƒì„±ì„ ìœ„í•œ Fixture
    â”‚   â””â”€â”€ auth.e2e-spec.ts
    â”‚   â”‚ 
    â”‚   â”‚ 
    â”‚   â”œâ”€â”€ auth.module.ts 
    â”‚   â””â”€â”€ main.ts    
    â”‚   
    â””â”€â”€ Dockerfile
```

---

### 2. Gateway Server (`apps/gateway`)

API GatewayëŠ” ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ ìš”ì²­ì˜ ë‹¨ì¼ ì§„ì…ì (Single Entry Point) ì—­í• ì„ ìˆ˜í–‰í•©ë‹ˆë‹¤. ì£¼ìš” ì±…ì„ì€ ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

*   ì¸ì¦ ë° ê¶Œí•œ ë¶€ì—¬: JWT í† í° ê²€ì¦ ë° ì—­í•  ê¸°ë°˜ ì ‘ê·¼ ì œì–´
*   ìš”ì²­ ë¼ìš°íŒ…: ìˆ˜ì‹ ëœ ìš”ì²­ì„ ì ì ˆí•œ ë‚´ë¶€ ë§ˆì´í¬ë¡œì„œë¹„ìŠ¤(`Auth`, `Events`)ë¡œ ì „ë‹¬


```text
apps/
â””â”€â”€ gateway/
    â”œâ”€â”€ src/
    â”‚   â”œâ”€â”€ auth                                        // ê²Œì´íŠ¸ì›¨ì´ ì¸ì¦ ê´€ë ¨ (ë‚´ë¶€/ì„¤ëª… ìƒëµ)
    â”‚   |   â”œâ”€â”€ decorators
    â”‚   |   â”œâ”€â”€ guards                  
    â”‚   |   â””â”€â”€ strategy                   
    â”‚   |
    â”‚   |
    â”‚   â”œâ”€â”€ config/                                     // ê²Œì´íŠ¸ì›¨ì´ ì„¤ì •
    â”‚   |   â””â”€â”€ gateway-proxy.config.ts                 // í”„ë¡ì‹œ ëŒ€ìƒ ê²½ë¡œ ì„¤ì •
    â”‚   â”‚
    â”‚   â”‚
    â”‚   â”œâ”€â”€ proxy/                                      // ë°±ì—”ë“œ ì„œë¹„ìŠ¤ë¡œì˜ ìš”ì²­ í”„ë¡ì‹œ ë° ë¼ìš°íŒ…
    â”‚   â”‚   â”œâ”€â”€ controllers/                            // ì„œë¹„ìŠ¤ ê·¸ë£¹ë³„ í”„ë¡ì‹œ ì»¨íŠ¸ë¡¤ëŸ¬ (ë‚´ë¶€ ìƒëµ)
    â”‚   â”‚   â””â”€â”€ services/                               // ì‹¤ì œ HTTP ìš”ì²­ í¬ì›Œë”© ë° ì‘ë‹µ ì²˜ë¦¬ ë¡œì§ (ë‚´ë¶€ ìƒëµ)
    â”‚   â”‚   â””â”€â”€ proxy.module.ts
    â”‚   â”‚ 
    â”‚   â”‚ 
    â”‚   â”œâ”€â”€ shared/                                    // ê²Œì´íŠ¸ì›¨ì´ ì „ì—­ì— ì‚¬ìš©ë˜ëŠ” ì½”ë“œ
    â”‚   |   â”œâ”€â”€ constnats/                 
    â”‚   |   |   â””â”€â”€ headers.constants.ts               // í”„ë¡ì‹œë¡œ ì „í•´ì§ˆ ì»¤ìŠ¤í…€ í—¤ë” ìƒìˆ˜
    â”‚   |   â””â”€â”€ errors
    â”‚   | 
    â”‚   | 
    â”‚   â”œâ”€â”€ app.module.ts
    â”‚   â””â”€â”€ main.ts 
    â”‚
    â”‚
    â”œâ”€â”€ test/
    â”‚   â””â”€â”€ gateway.e2e-spec.ts
    â”‚ 
    â””â”€â”€ Dockerfile
```


---

### 3. Event Server (`apps/event`)

Event ServerëŠ” ì´ë²¤íŠ¸ ìƒì„±/ê´€ë¦¬, ë³´ìƒ ì •ì˜, ì‚¬ìš©ì ë³´ìƒ ìš”ì²­ ì²˜ë¦¬ ë° ë‚´ì—­ ê´€ë¦¬ë¥¼ ë‹´ë‹¹í•©ë‹ˆë‹¤. ì´ˆê¸°ì—ëŠ” ë‹¨ì¼ ëª¨ë“ˆë¡œ êµ¬ì„±ë˜ì—ˆìœ¼ë‚˜, ê¸°ëŠ¥ í™•ì¥ê³¼ ì±…ì„ ë¶„ë¦¬ë¥¼ ìœ„í•´ ë‹¤ìŒê³¼ ê°™ì´ í•˜ìœ„ ëª¨ë“ˆë¡œ ì¬êµ¬ì„±ë˜ì—ˆìŠµë‹ˆë‹¤.

*   **`EventCoreModule`**: ì´ë²¤íŠ¸ ìì²´ì˜ CRUD, ì¡°ê±´ ì •ì˜ ë° ê²€ì¦, ì™¸ë¶€ ì„œë¹„ìŠ¤(Auth) ì—°ë™ì„ í†µí•œ ìœ ì € í™œë™ ë°ì´í„° ì¡°íšŒ ë“± ì´ë²¤íŠ¸ì˜ í•µì‹¬ ê¸°ëŠ¥ì„ ë‹´ë‹¹.
*   **`RewardModule`**: ì´ë²¤íŠ¸ì— ì—°ê²°ë˜ëŠ” ë³´ìƒì˜ CRUD, ë³´ìƒ ìƒì„¸ ì •ë³´ ìœ íš¨ì„± ê²€ì¦, ë³´ìƒ ìˆ˜ëŸ‰ ê´€ë¦¬ ë“±ì„ ë‹´ë‹¹.
*   **`EventClaimModule`**: ì‚¬ìš©ìì˜ ì´ë²¤íŠ¸ ë³´ìƒ ìš”ì²­ ì²˜ë¦¬, ì¡°ê±´ ë§¤ì¹­, íŠ¸ëœì­ì…”ë„í•œ ë³´ìƒ ì§€ê¸‰, ìš”ì²­ ë‚´ì—­ ê´€ë¦¬ ë° ì¡°íšŒë¥¼ ë‹´ë‹¹.

```text
apps/
â””â”€â”€ event/
    â”œâ”€â”€ src/
    â”‚   â”œâ”€â”€ config/                                // ì„œë¹„ìŠ¤ URL, DB URI ë“± ì„¤ì •
    â”‚   â”‚   â””â”€â”€ services.config.ts                 // ì™¸ë¶€ ì„œë¹„ìŠ¤ì™€ì˜ ì„¤ì •
    â”‚   â”‚
    â”‚   â”œâ”€â”€ event-core/                            // ì´ë²¤íŠ¸ í•µì‹¬ ê¸°ëŠ¥ ëª¨ë“ˆ
    â”‚   â”‚   â”œâ”€â”€ application/
    â”‚   â”‚   â”‚   â”œâ”€â”€ config/                        // ì´ë²¤íŠ¸ ì¡°ê±´ ê´€ë ¨ ì„¤ì • (ì§€ì›í•˜ëŠ” ì´ë²¤íŠ¸ì— ëŒ€í•œ ì„¤ì •)
    â”‚   â”‚   â”‚   â”œâ”€â”€ ports/                         
    â”‚   â”‚   â”‚   â”œâ”€â”€ services/                      
    â”‚   â”‚   â”‚   â””â”€â”€ use-cases/                     
    â”‚   â”‚   â”œâ”€â”€ domain/
    â”‚   â”‚   â”‚   â”œâ”€â”€ entities/                      // Event ì—”í‹°í‹°
    â”‚   â”‚   â”‚   â”œâ”€â”€ embedded/                      // EventCondition ìŠ¤í‚¤ë§ˆ (Event ì—”í‹°í‹° ë‚´ ì‚¬ìš©)
    â”‚   â”‚   â”‚   â”œâ”€â”€ errors/                        
    â”‚   â”‚   â”‚   â”œâ”€â”€ factories/                     
    â”‚   â”‚   â”‚   â”œâ”€â”€ ports/                       
    â”‚   â”‚   â”‚   â””â”€â”€ value-objects/                 // ê°’ ìì²´(ì´ë²¤íŠ¸ ìƒíƒœ, ì´ë²¤íŠ¸ ì¡°ê±´ì˜ operator, ì´ë²¤íŠ¸ ì¡°ê±´ì˜ ì¹´í…Œê³ ë¦¬)
    â”‚   â”‚   â”œâ”€â”€ infrastructure/
    â”‚   â”‚   â”‚   â”œâ”€â”€ adapters/                      // UserActivityHttpFetcher (Auth ì„œë²„ ì—°ë™)
    â”‚   â”‚   â”‚   â”œâ”€â”€ factories/                    
    â”‚   â”‚   â”‚   â””â”€â”€ persistence/                  
    â”‚   â”‚   â”œâ”€â”€ presentation/
    â”‚   â”‚   â”‚   â”œâ”€â”€ controllers/                  
    â”‚   â”‚   â”‚   â””â”€â”€ dtos/                         
    â”‚   â”‚   â””â”€â”€ event-core.module.ts
    â”‚   â”‚
    â”‚   â”œâ”€â”€ reward/                                // ë³´ìƒ ê´€ë¦¬ ëª¨ë“ˆ
    â”‚   â”‚   â”œâ”€â”€ application/
    â”‚   â”‚   â”‚   â”œâ”€â”€ services/                 
    â”‚   â”‚   â”‚   â””â”€â”€ use-cases/                     
    â”‚   â”‚   â”œâ”€â”€ domain/
    â”‚   â”‚   â”‚   â”œâ”€â”€ entities/                 
    â”‚   â”‚   â”‚   â”œâ”€â”€ errors/                   
    â”‚   â”‚   â”‚   â”œâ”€â”€ factories/                
    â”‚   â”‚   â”‚   â”œâ”€â”€ ports/                    
    â”‚   â”‚   â”‚   â””â”€â”€ value-objects/            
    â”‚   â”‚   â”œâ”€â”€ infrastructure/
    â”‚   â”‚   â”‚   â”œâ”€â”€ factories/                    
    â”‚   â”‚   â”‚   â””â”€â”€ persistence/                  
    â”‚   â”‚   â”œâ”€â”€ presentation/
    â”‚   â”‚   â”‚   â”œâ”€â”€ controllers/                  
    â”‚   â”‚   â”‚   â””â”€â”€ dtos/                         
    â”‚   â”‚   â””â”€â”€ reward.module.ts
    â”‚   â”‚
    â”‚   â”œâ”€â”€ event-claim/                           // ì´ë²¤íŠ¸ í´ë ˆì„(ë³´ìƒ ì‹ ì²­) ëª¨ë“ˆ
    â”‚   â”‚   â”œâ”€â”€ application/
    â”‚   â”‚   â”‚   â””â”€â”€ use-cases/                     // ClaimRewardUseCase, ListMyEventClaimsUseCase, ListAllEventClaimsUseCase
    â”‚   â”‚   â”œâ”€â”€ domain/
    â”‚   â”‚   â”‚   â”œâ”€â”€ entities/         
    â”‚   â”‚   â”‚   â”œâ”€â”€ embedded/        
    â”‚   â”‚   â”‚   â”œâ”€â”€ errors/          
    â”‚   â”‚   â”‚   â”œâ”€â”€ factories/       
    â”‚   â”‚   â”‚   â”œâ”€â”€ interfaces/      
    â”‚   â”‚   â”‚   â””â”€â”€ ports/           
    â”‚   â”‚   â”œâ”€â”€ infrastructure/
    â”‚   â”‚   â”‚   â”œâ”€â”€ factories/       
    â”‚   â”‚   â”‚   â””â”€â”€ persistence/     
    â”‚   â”‚   â”œâ”€â”€ presentation/
    â”‚   â”‚   â”‚   â”œâ”€â”€ controllers/     
    â”‚   â”‚   â”‚   â””â”€â”€ dtos/            
    â”‚   â”‚   â””â”€â”€ event-claim.module.ts
    â”‚   â”‚
    â”‚   â”œâ”€â”€ event-app.module.ts                          // Event ì„œë²„ì˜ ìµœìƒìœ„ ëª¨ë“ˆ (ìœ„ ê¸°ëŠ¥ ëª¨ë“ˆë“¤ì„ imports)
    â”‚   â””â”€â”€ main.ts
    â”‚
    â”œâ”€â”€ test/
    â”‚   â”œâ”€â”€ fixture/                               // í…ŒìŠ¤íŠ¸ìš© Fixture ë°ì´í„° ìƒì„± ë¡œì§
    â”‚   â””â”€â”€ event-claim.e2e-spec.ts                // ì´ë²¤íŠ¸ ë³´ìƒ ì‹ ì²­ e2e (ìœ ì € ìƒì„± ~ ë³´ìƒ ì‹ ì²­ í›„ ì¡°íšŒê¹Œì§€ì˜ í”Œë¡œìš° e2e)
    â”‚  
    â””â”€â”€ Dockerfile
```

---
